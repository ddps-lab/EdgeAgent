# MCP Filesystem Server with mcp-proxy (stateless HTTP mode)
#
# Uses mcp-proxy to expose stdio-based MCP server over HTTP
# https://github.com/punkpeye/mcp-proxy
#
# Usage:
#   docker build -f Dockerfile.filesystem -t edgeagent-mcp-filesystem .
#   docker run -p 8080:8080 -e ALLOWED_PATH=/data -v /my/data:/data edgeagent-mcp-filesystem

FROM node:20-slim

WORKDIR /app

# Install mcp-proxy and filesystem server
RUN npm install -g mcp-proxy @modelcontextprotocol/server-filesystem

# Environment variables
ENV MCP_PORT=8080
ENV ALLOWED_PATH=/data

# Expose HTTP port
EXPOSE 8080

# Run mcp-proxy in stateless mode wrapping filesystem server
# --stateless: No session state, each request is independent
CMD ["sh", "-c", "mcp-proxy --port ${MCP_PORT} --stateless mcp-server-filesystem ${ALLOWED_PATH}"]
